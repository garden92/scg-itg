spring:
  application:
    name: kol-itg-gateway-test

# 테스트 환경 설정
server:
  port: 0  # 랜덤 포트 사용

# Mock 서버를 위한 테스트 설정
webclient:
  connection-timeout: 1000   # 테스트용 짧은 타임아웃
  read-timeout: 5000        # 테스트용 짧은 타임아웃
  write-timeout: 3000

# Circuit Breaker 테스트 설정
resilience4j.circuitbreaker:
  configs:
    default:
      registerHealthIndicator: true
      slidingWindowType: COUNT_BASED
      slidingWindowSize: 5     # 테스트용 작은 윈도우
      minimumNumberOfCalls: 3  # 테스트용 작은 최소 호출 수
      failureRateThreshold: 50 # 50% 실패 시 열림
      slowCallRateThreshold: 50
      slowCallDurationThreshold: 2000
      permittedNumberOfCallsInHalfOpenState: 2
      waitDurationInOpenState: 3s  # 테스트용 짧은 대기
      eventConsumerBufferSize: 10
  instances:
    testcirguitbreaker:
      baseConfig: default

# 테스트 로깅 설정
logging:
  level:
    com.kt.kol: DEBUG
    org.springframework.cloud.gateway: DEBUG
    root: INFO
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# Feature 플래그 테스트 설정  
feature:
  use-optimized-handler: true

# Mock 서버 설정 (동적으로 할당됨)
soap:
  service:
    ord-po-end-point: http://localhost:${mock.ord.port:8888}/SoapDynamicGateway
    ord-esb-end-point: http://localhost:${mock.ord.port:8888}/SoapGateway  
    crm-po-end-point: http://localhost:${mock.crm.port:8889}/SoapDynamicGateway
    crm-esb-end-point: http://localhost:${mock.crm.port:8889}/SoapGateway
    stub-end-point: http://localhost:${mock.stub.port:8890}/soap-perf-stub